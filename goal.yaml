docker-build:
  containers:
  - name: docker build
    image: docker:19.03.4
    args:
    - sh
    - -c
    - >-
      docker build . -f Dockerfile -t atomist/${push.repo.name}:${push.after.version} &&
      docker push atomist/${push.repo.name}:${push.after.version} &&
      echo '{ "SdmGoal": { "push": { "after": { "images" :[{ "imageName": "atomist/${push.repo.name}:${push.after.version}" }] } } } }' > $ATOMIST_RESULT
    volume_mounts:
    - name: sock
      mount_path: /var/run/docker.sock
  volumes:
  - name: sock
    host_path:
      path: /var/run/docker.sock
  retry: true
  
